{% extends "base.html" %}
{% block content %}
<section class="max-w-6xl mx-auto px-4 sm:px-6 pt-16 pb-24">
  <h1 class="text-3xl md:text-4xl font-extrabold mb-8">Experience</h1>

  <div class="grid md:grid-cols-3 gap-6 auto-rows-fr">
    {% for x in items %}
    <div data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}"
         class="perspective-container h-full">

      <!-- Tilt container -->
      <div class="gradient-border rounded-xl h-full transition-transform duration-300 ease-out tilt-card">

        <!-- Bubble wrapper inside tilt -->
        <div class="glass p-6 rounded-xl bubble-card bubble-{{ loop.index0 }} h-full flex flex-col">
          <div class="flex items-center justify-between mb-2">
            <h3 class="text-xl font-semibold">{{ x.role }}</h3>
            <span class="company-tag">{{ x.company }}</span>
          </div>

          <div class="mb-3 text-sm text-gray-400">
            {{ x.period }}
            {% if x.location %}
            <span class="ml-2 px-2 py-1 text-xs text-gray-400 font-medium rounded-full bg-gray-700">{{ x.location }}</span>
            {% endif %}
          </div>

          <ul class="mt-3 text-gray-300 space-y-1 flex-grow">
            {% for b in x.bullets %}
              <li class="flex items-start">
                <span class="mr-2 text-purple-400">â€¢</span>
                <span>{{ b }}</span>
              </li>
            {% endfor %}
          </ul>

          <div class="mt-4 flex flex-wrap gap-2">
            {% for skill in x.skills %}
              <span class="skill-tag">{{ skill }}</span>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<style>
/* Perspective for 3D tilt */
.perspective-container {
  perspective: 1000px;
}

/* Bubbling motion */
@keyframes bubble {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(var(--bubble-height)); }
}

.bubble-card {
  animation-timing-function: ease-in-out;
  animation-iteration-count: infinite;
}

/* Different speeds & amplitudes */
.bubble-0 { --bubble-height: -6px; animation: bubble 4s ease-in-out infinite; }
.bubble-1 { --bubble-height: -8px; animation: bubble 5s ease-in-out infinite; }
.bubble-2 { --bubble-height: -5px; animation: bubble 4.5s ease-in-out infinite; }
.bubble-3 { --bubble-height: -7px; animation: bubble 5.2s ease-in-out infinite; }
.bubble-4 { --bubble-height: -9px; animation: bubble 4.8s ease-in-out infinite; }
.bubble-5 { --bubble-height: -6px; animation: bubble 5.5s ease-in-out infinite; }

/* Pure CSS animated gradient border */
.gradient-border {
  position: relative;
  border: 2px solid transparent;
  background:
    linear-gradient(#0b1020, #0b1020) padding-box,
    linear-gradient(270deg, #8b5cf6, #22d3ee, #8b5cf6) border-box;
  background-size: 400% 400%;
  animation: borderGradient 6s ease infinite;
  border-radius: 0.75rem;
  overflow: hidden; /* keep reflection inside */
}

@keyframes borderGradient {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Moving light reflection overlay */
.tilt-card::after {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle at var(--light-x, 50%) var(--light-y, 50%), rgba(255,255,255,0.08), transparent 70%);
  pointer-events: none;
  animation: sweepLight 14s ease-in-out infinite;
}

/* Idle sweep animation with pause at ends */
@keyframes sweepLight {
  0% {
    --light-x: 0%;
    --light-y: 0%;
  }
  20% {
    --light-x: 0%;
    --light-y: 0%;
  }
  50% {
    --light-x: 100%;
    --light-y: 100%;
  }
  70% {
    --light-x: 100%;
    --light-y: 100%;
  }
  100% {
    --light-x: 0%;
    --light-y: 0%;
  }
}
</style>

<script>
// 3D tilt + shadow shift + override idle reflection
document.querySelectorAll('.tilt-card').forEach(card => {
  card.addEventListener('mousemove', e => {
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;

    // Tilt
    const rotateX = ((y - centerY) / centerY) * 8;
    const rotateY = ((x - centerX) / centerX) * 8;
    card.style.transform = `rotateX(${-rotateX}deg) rotateY(${rotateY}deg)`;

    // Shadow shift
    const shadowX = ((x - centerX) / centerX) * 20;
    const shadowY = ((y - centerY) / centerY) * 20;
    card.style.boxShadow = `${-shadowX}px ${-shadowY}px 30px rgba(139, 92, 246, 0.4)`;

    // Override idle reflection
    card.style.setProperty('--light-x', `${(x / rect.width) * 100}%`);
    card.style.setProperty('--light-y', `${(y / rect.height) * 100}%`);
  });

  card.addEventListener('mouseleave', () => {
    card.style.transform = 'rotateX(0deg) rotateY(0deg)';
    card.style.boxShadow = '0 0 20px rgba(139, 92, 246, 0.2)';
    card.style.removeProperty('--light-x');
    card.style.removeProperty('--light-y');
  });
});
</script>
{% endblock %}